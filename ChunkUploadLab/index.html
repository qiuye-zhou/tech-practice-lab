<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>大文件分片与断点续传实验</title>
  <style>
    * { box-sizing: border-box; text-align: center; }
    body { max-width: 800px; margin: 0 auto; padding: 20px; }
    .upload-container { border: 10px dashed #cccccc; padding: 40px; text-align: center; margin: 20px 0px; }
    .upload-container input { text-align: center; }
    .upload-container.dragover { border-color: #0077ff; background-color: #ffffff; }
    .progress-container { margin: 20px 0px; }
    progress { width: 100%; height: 20px; }
    .controls { margin: 20px 0px; }
    button { padding: 10px 20px; margin: 0 20px; background: #0077ff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:disabled { background: #c0c0c0; cursor: not-allowed; }
    button.pause { background: #ffd000; }
    button.cancel { background: #ff4053; }
    .status { margin: 20px 0px; padding: 10px; border-radius: 4px; }
    .status.success { background: #00db33; color: #ffffff; }
    .status.error { background: #ff0015; color: #ffffff; }
  </style>
</head>
<body>
  <h1>大文件分片与断点续传实验</h1>

  <!-- 上传文件 -->
  <div class="upload-container" id="uploadFileContainer">
    <p>拖放文件到此处或</p>
    <input type="file" id="fileInput">
  </div>

  <!-- 上传进度 -->
  <div class="progress-container">
    <div>整体上传进度: <span id="overallProgress"></span></div>
    <progress id="overallProgressBar" value="0" max="100"></progress>

    <div>当前分片上传进度: <span id="currentChunk"></span></div>
    <progress id="currentChunkProgressBar" value="0" max="100"></progress>
  </div>

  <!-- 控制按钮 -->
  <div class="controls">
    <button id="pauseBtn" class="pause" disabled>暂停</button>
    <button id="resumeBtn" disabled>继续</button>
    <button id="cancelBtn" class="cancel" disabled>取消</button>
  </div>

  <!-- 上传结果状态 -->
  <div id="status" class="status"></div>
  <div id="chunkUploadResults" style="margin-top: 20px;">
    <h3>分片上传结果</h3>
    <ul id="chunkUploadResultsList" style="list-style-type: none; padding: 0;"></ul>
  </div>

  <script>
    class controlsUploader {
      constructor(maxCount = 5) {
        this.maxCount = maxCount; // 最大并发数
        this.queue = []; // 待上传任务队列
        this.activeCount = 0; // 当前活活跃任务数
        this.paused = false; // 是否暂停
      }

      addTask(task) {
        this.queue.push(task);
        this.run();
      }

      async run() {
        if (this.activeCount >= this.maxCount || this.queue.length === 0 || this.paused) {
          return;
        }

        const task = this.queue.shift();
        this.activeCount++;

        try {
          await task();
        } catch (error) {
          console.error(error);
        } finally {
          this.activeCount--;
          this.run();
        }
      }

      pause() {
        this.paused = true;
      }

      resume() {
        this.paused = false;
        this.run();
      }

      clear() {
        this.queue = [];
        this.activeCount = 0;
        this.paused = false;
      }
    }

    const uploadFileContainer = document.getElementById('uploadFileContainer');
    const fileInput = document.getElementById('fileInput');
    const overallProgress = document.getElementById('overallProgress');
    const overallProgressBar = document.getElementById('overallProgressBar');
    const currentChunk = document.getElementById('currentChunk');
    const currentChunkProgressBar = document.getElementById('currentChunkProgressBar');
    const pauseBtn = document.getElementById('pauseBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const status = document.getElementById('status');
    const chunkUploadResultsList = document.getElementById('chunkUploadResultsList');
  </script>
</body>
</html>